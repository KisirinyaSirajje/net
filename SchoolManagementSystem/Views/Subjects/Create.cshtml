@model SchoolManagementSystem.Models.Subject

@{
    ViewData["Title"] = "Create New Subject";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Index">Subjects</a></li>
                    <li class="breadcrumb-item active">Create New Subject</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-plus-circle"></i> Create New Subject
                    </h4>
                    <small>Add a new subject to the Uganda curriculum</small>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group mb-3">
                                    <label asp-for="Name" class="form-label">Subject Name <span class="text-danger">*</span></label>
                                    <input asp-for="Name" class="form-control" placeholder="e.g., Mathematics, Physics, English Language" />
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label asp-for="Code" class="form-label">Subject Code</label>
                                    <input asp-for="Code" class="form-control" placeholder="e.g., MATH, PHY, ENG" />
                                    <span asp-validation-for="Code" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="Level" class="form-label">Education Level <span class="text-danger">*</span></label>
                                    <select asp-for="Level" class="form-select">
                                        <option value="">Select Level</option>
                                        <option value="0">O-Level (S1-S4)</option>
                                        <option value="1">A-Level (S5-S6)</option>
                                    </select>
                                    <span asp-validation-for="Level" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="Type" class="form-label">Subject Type <span class="text-danger">*</span></label>
                                    <select asp-for="Type" class="form-select">
                                        <option value="">Select Type</option>
                                        <option value="0">Compulsory</option>
                                        <option value="1">Elective</option>
                                        <option value="2">Optional</option>
                                    </select>
                                    <span asp-validation-for="Type" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="Stream" class="form-label">Stream/Track</label>
                                    <select asp-for="Stream" class="form-select">
                                        <option value="0">Not Applicable</option>
                                        <option value="1">Science/STEM</option>
                                        <option value="2">Arts/Humanities</option>
                                        <option value="3">Business/Commerce</option>
                                        <option value="4">Technical</option>
                                    </select>
                                    <span asp-validation-for="Stream" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label asp-for="Credits" class="form-label">Credits/Hours</label>
                                    <input asp-for="Credits" type="number" class="form-control" min="1" max="10" value="1" />
                                    <span asp-validation-for="Credits" class="text-danger"></span>
                                    <div class="form-text">Number of credit hours per week (1-10)</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="form-group mb-3">
                                    <label asp-for="Description" class="form-label">Description</label>
                                    <textarea asp-for="Description" class="form-control" rows="3" placeholder="Brief description of the subject curriculum and objectives..."></textarea>
                                    <span asp-validation-for="Description" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Subject Guidelines -->
                        <div class="card bg-light mb-4">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fas fa-info-circle"></i> Uganda Curriculum Guidelines
                                </h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="text-primary">O-Level Subjects (S1-S4)</h6>
                                        <ul class="small mb-2">
                                            <li><strong>Compulsory:</strong> English, Mathematics, Biology, Chemistry, Physics, History, Geography</li>
                                            <li><strong>Elective:</strong> Literature, French, Arabic, Computer Studies, Agriculture</li>
                                            <li><strong>Optional:</strong> Music, Fine Art, Technical Drawing</li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-success">A-Level Subjects (S5-S6)</h6>
                                        <ul class="small mb-2">
                                            <li><strong>Science:</strong> Mathematics, Physics, Chemistry, Biology</li>
                                            <li><strong>Arts:</strong> History, Geography, Literature, Divinity</li>
                                            <li><strong>Business:</strong> Economics, Mathematics, Geography, Entrepreneurship</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Buttons -->
                        <div class="d-flex justify-content-between">
                            <div>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Create Subject
                                </button>
                                <a class="btn btn-secondary" asp-action="Index">
                                    <i class="fas fa-arrow-left"></i> Back to List
                                </a>
                            </div>
                            <div>
                                <button type="reset" class="btn btn-outline-secondary">
                                    <i class="fas fa-undo"></i> Reset Form
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Card -->
    <div class="row justify-content-center mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-eye"></i> Subject Preview
                    </h6>
                </div>
                <div class="card-body" id="subject-preview">
                    <div class="text-muted text-center py-3">
                        <i class="fas fa-book fa-2x mb-2"></i>
                        <br>
                        Fill in the form above to see a preview of the subject
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Real-time form preview
        function updatePreview() {
            const name = document.querySelector('input[name="Name"]').value;
            const code = document.querySelector('input[name="Code"]').value;
            const level = document.querySelector('select[name="Level"]').selectedOptions[0]?.text || '';
            const type = document.querySelector('select[name="Type"]').selectedOptions[0]?.text || '';
            const stream = document.querySelector('select[name="Stream"]').selectedOptions[0]?.text || '';
            const credits = document.querySelector('input[name="Credits"]').value;
            const description = document.querySelector('textarea[name="Description"]').value;

            const preview = document.getElementById('subject-preview');
            
            if (!name && !code) {
                preview.innerHTML = `
                    <div class="text-muted text-center py-3">
                        <i class="fas fa-book fa-2x mb-2"></i>
                        <br>
                        Fill in the form above to see a preview of the subject
                    </div>`;
                return;
            }

            const levelClass = level.includes('O-Level') ? 'badge-primary' : 'badge-success';
            const typeClass = type === 'Compulsory' ? 'badge-danger' : type === 'Elective' ? 'badge-warning' : 'badge-info';
            
            preview.innerHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <h5>${name || 'Subject Name'} ${code ? '(' + code + ')' : ''}</h5>
                        <p class="mb-2">${description || 'No description provided'}</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="mb-2">
                            <span class="badge ${levelClass}">${level || 'Level'}</span>
                        </div>
                        <div class="mb-2">
                            <span class="badge ${typeClass}">${type || 'Type'}</span>
                        </div>
                        ${stream !== 'Not Applicable' ? '<div class="mb-2"><span class="badge badge-secondary">' + stream + '</span></div>' : ''}
                        <div>
                            <small class="text-muted">${credits || '1'} Credit Hours</small>
                        </div>
                    </div>
                </div>`;
        }

        // Add event listeners for real-time preview
        document.querySelectorAll('input, select, textarea').forEach(element => {
            element.addEventListener('input', updatePreview);
            element.addEventListener('change', updatePreview);
        });

        // Auto-generate subject code from name
        document.querySelector('input[name="Name"]').addEventListener('input', function() {
            const codeField = document.querySelector('input[name="Code"]');
            if (!codeField.value) { // Only auto-generate if code field is empty
                const name = this.value;
                const words = name.split(' ').filter(word => word.length > 0);
                if (words.length > 0) {
                    let code = '';
                    if (words.length === 1) {
                        code = words[0].substring(0, 4).toUpperCase();
                    } else {
                        code = words.map(word => word.substring(0, 2)).join('').toUpperCase();
                        if (code.length > 5) {
                            code = code.substring(0, 5);
                        }
                    }
                    codeField.value = code;
                }
            }
        });

        // Form validation enhancement
        document.querySelector('form').addEventListener('submit', function(e) {
            const requiredFields = ['Name', 'Level', 'Type'];
            let isValid = true;
            
            requiredFields.forEach(fieldName => {
                const field = document.querySelector(`[name="${fieldName}"]`);
                const value = field.value.trim();
                
                if (!value) {
                    isValid = false;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                alert('Please fill in all required fields marked with *');
            }
        });
    </script>
}